<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Codeforces Next Problems</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>

    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css"
    />

    <script type="text/javascript">
      $(function () {
        function buildProblemId(obj) {
          return `${obj.contestId || ""}${obj.index}`;
        }

        function compareProblems(problem1, problem2) {
          return problem2.solvedCount - problem1.solvedCount;
        }

        function prepareMainProblems(problems, problemStatistics, submissions) {
          const idToProblem = {};
          for (let i = 0; i < problems.length; i++) {
            idToProblem[buildProblemId(problems[i])] = problems[i];
            problems[i].problemset = "MAIN";
            problems[i].solved = false;
          }
          for (let i = 0; i < problemStatistics.length; i++) {
            idToProblem[buildProblemId(problemStatistics[i])].solvedCount =
              problemStatistics[i].solvedCount;
          }

          for (let i = 0; i < submissions.length; i++) {
            if (
              !submissions[i].problem.hasOwnProperty("problemsetName") &&
              submissions[i].verdict === "OK"
            ) {
              let problem = submissions[i].problem;
              if (!idToProblem.hasOwnProperty(buildProblemId(problem))) {
                const alternativeProblem = problems.filter(
                  (p) => p.name === submissions[i].problem.name
                )[0];

                if (alternativeProblem !== undefined) {
                  problem = alternativeProblem;
                }
              }

              const problemId = buildProblemId(problem);
              if (idToProblem.hasOwnProperty(problemId)) {
                idToProblem[problemId].solved = true;
                idToProblem[problemId].solvedTime =
                  submissions[i].creationTimeSeconds;
              }
            }
          }
        }

        function renderMain(problems, problemStatistics, submissions) {
          prepareMainProblems(problems, problemStatistics, submissions);

          const DUPLICATE_CONTEST_IDS = [1298];
          const solvedNum =
            problems.filter((problem) => problem.solved).length +
            submissions.filter(
              (submission) =>
                !submission.problem.hasOwnProperty("problemsetName") &&
                submission.verdict === "OK" &&
                DUPLICATE_CONTEST_IDS.includes(submission.problem.contestId)
            ).length;

          const nextUnsolvedProblems = problems
            .filter((problem) => !problem.solved)
            .sort(compareProblems)
            .slice(0, 5);

          $("#mainSolvedNum").text(solvedNum);

          nextUnsolvedProblems.forEach((problem) => {
            const url = `https://codeforces.com/problemset/problem/${problem.contestId}/${problem.index}`;

            $("#mainProblems tbody").append(`
              <tr>
                <th scope="row">
                  <a href="${url}">${buildProblemId(problem)}</a>
                </th>
                <td><a href="${url}">${problem.name}</a></td>
                <td>${problem.rating || ""}</td>
                <td>${problem.solvedCount}</td>
              </tr>
              `);
          });
        }

        function prepareAcmsguruProblems(
          problems,
          problemStatistics,
          submissions
        ) {
          const idToProblem = {};
          for (let i = 0; i < problems.length; i++) {
            idToProblem[buildProblemId(problems[i])] = problems[i];
            problems[i].problemset = "ACMSGURU";
            problems[i].solved = false;
          }
          for (let i = 0; i < problemStatistics.length; i++) {
            idToProblem[buildProblemId(problemStatistics[i])].solvedCount =
              problemStatistics[i].solvedCount;
          }

          for (let i = 0; i < submissions.length; i++) {
            if (
              submissions[i].problem.problemsetName === "acmsguru" &&
              submissions[i].verdict === "OK"
            ) {
              const problemId = buildProblemId(submissions[i].problem);
              idToProblem[problemId].solved = true;
              idToProblem[problemId].solvedTime =
                submissions[i].creationTimeSeconds;
            }
          }
        }

        function renderAcmsguru(problems, problemStatistics, submissions) {
          prepareAcmsguruProblems(problems, problemStatistics, submissions);

          const solvedNum = problems.filter((problem) => problem.solved).length;
          const nextUnsolvedProblems = problems
            .filter((problem) => !problem.solved)
            .sort(compareProblems)
            .slice(0, 5);

          $("#acmsguruSolvedNum").text(solvedNum);

          nextUnsolvedProblems.forEach((problem) => {
            const url = `https://codeforces.com/problemsets/acmsguru/problem/99999/${problem.index}`;

            $("#acmsguruProblems tbody").append(`
              <tr>
                <th scope="row"><a href="${url}">${problem.index}</a></th>
                <td><a href="${url}">${problem.name}</a></td>
                <td>${problem.solvedCount}</td>
              </tr>
              `);
          });
        }

        let mainProblems = null;
        let mainProblemStatistics = null;
        let acmsguruProblems = null;
        let acmsguruProblemStatistics = null;

        function renderSolved(submissions) {
          if (mainProblems === null || acmsguruProblems === null) {
            return;
          }

          prepareMainProblems(mainProblems, mainProblemStatistics, submissions);
          prepareAcmsguruProblems(
            acmsguruProblems,
            acmsguruProblemStatistics,
            submissions
          );

          const solvedProblems = mainProblems
            .concat(acmsguruProblems)
            .filter((problem) => problem.solved);

          solvedProblems.forEach((problem) => {
            let url;
            if (problem.problemset === "MAIN") {
              url = `https://codeforces.com/problemset/problem/${problem.contestId}/${problem.index}`;
            } else if (problem.problemset === "ACMSGURU") {
              url = `https://codeforces.com/problemsets/acmsguru/problem/99999/${problem.index}`;
            }

            $("#solvedProblems tbody").append(`
              <tr>
                <th scope="row">${problem.problemset}</th>
                <td><a href="${url}">${buildProblemId(problem)}</a></td>
                <td><a href="${url}">${problem.name}</a></td>
                <td>${problem.tags.join(", ")}</td>
                <td>${problem.rating || ""}</td>
                <td>${problem.solvedCount}</td>
                <td>${moment(new Date(problem.solvedTime * 1000)).format()}</td>
              </tr>
              `);
          });

          $("#solvedProblems").DataTable({
            columnDefs: [{ orderable: false, targets: 3 }],
            order: [[6, "desc"]],
          });
        }

        $.ajax({
          url: "https://codeforces.com/api/user.status",
          jsonp: "jsonp",
          dataType: "jsonp",
          data: {
            handle: "goalboy",
          },
          success: function (response) {
            const submissions = response.result;

            $.ajax({
              url: "https://codeforces.com/api/problemset.problems",
              jsonp: "jsonp",
              dataType: "jsonp",
              data: {},
              success: function (response) {
                const problems = response.result.problems;
                const problemStatistics = response.result.problemStatistics;

                renderMain(problems, problemStatistics, submissions);

                mainProblems = problems;
                mainProblemStatistics = problemStatistics;
                renderSolved(submissions);
              },
            });

            $.ajax({
              url: "https://codeforces.com/api/problemset.problems",
              jsonp: "jsonp",
              dataType: "jsonp",
              data: {
                problemsetName: "acmsguru",
              },
              success: function (response) {
                const problems = response.result.problems;
                const problemStatistics = response.result.problemStatistics;

                renderAcmsguru(problems, problemStatistics, submissions);

                acmsguruProblems = problems;
                acmsguruProblemStatistics = problemStatistics;
                renderSolved(submissions);
              },
            });
          },
        });
      });
    </script>
  </head>
  <body>
    <div class="row m-1">
      <div class="col-sm-7">
        <div class="card">
          <div class="card-header">
            MAIN Solved Problems:
            <span id="mainSolvedNum" style="color: green;"></span>
          </div>
          <div class="card-body">
            <h5 class="card-title">
              Next Unsolved Problems
            </h5>
            <table id="mainProblems" class="table table-striped">
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">Name</th>
                  <th scope="col">Difficulty</th>
                  <th scope="col">Solved Count</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="col-sm-5">
        <div class="card">
          <div class="card-header">
            ACMSGURU Solved Problems:
            <span id="acmsguruSolvedNum" style="color: green;"></span>
          </div>
          <div class="card-body">
            <h5 class="card-title">
              Next Unsolved Problems
            </h5>
            <table id="acmsguruProblems" class="table table-striped">
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">Name</th>
                  <th scope="col">Solved Count</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="row m-1 mt-5">
      <div class="col-sm">
        <div class="card">
          <div class="card-header">
            All Solved Problems
          </div>
          <div class="card-body">
            <table id="solvedProblems" class="table table-striped">
              <thead>
                <tr>
                  <th scope="col">Problem Set</th>
                  <th scope="col">#</th>
                  <th scope="col">Name</th>
                  <th scope="col">Tags</th>
                  <th scope="col">Difficulty</th>
                  <th scope="col">Solved Count</th>
                  <th scope="col">Solved Time</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
